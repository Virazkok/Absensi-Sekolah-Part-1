import{g as he,u as xe,r as s,a as G,j as e,H as ue}from"./app-Db-aw5MQ.js";import{d as n}from"./dayjs.min-CA_xttg3.js";/* empty css            */var B={exports:{}},pe=B.exports,ee;function ge(){return ee||(ee=1,function(d,f){(function(j,M){d.exports=M()})(pe,function(){var j="day";return function(M,K,S){var y=function(i){return i.add(4-i.isoWeekday(),j)},p=K.prototype;p.isoWeekYear=function(){return y(this).year()},p.isoWeek=function(i){if(!this.$utils().u(i))return this.add(7*(i-this.isoWeek()),j);var h,m,x,v,Z=y(this),D=(h=this.isoWeekYear(),m=this.$u,x=(m?S.utc:S)().year(h).startOf("year"),v=4-x.isoWeekday(),x.isoWeekday()>4&&(v+=7),x.add(v,j));return Z.diff(D,"week")+1},p.isoWeekday=function(i){return this.$utils().u(i)?this.day()||7:this.day(this.day()%7?i:i-7)};var $=p.startOf;p.startOf=function(i,h){var m=this.$utils(),x=!!m.u(h)||h;return m.p(i)==="isoweek"?x?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):$.bind(this)(i,h)}}})}(B)),B.exports}var be=ge();const fe=he(be);n.extend(fe);const L=({title:d,value:f})=>e.jsxs("div",{className:"bg-white rounded-xl border border-[#6200EE] shadow-sm p-4 flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm text-gray-500 text-center",children:d}),e.jsx("div",{className:"text-2xl font-bold mt-2 text-center",children:f})]}),J=({label:d,percent:f})=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("div",{className:"text-gray-600",children:d}),e.jsxs("div",{className:"text-gray-600",children:[f,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-indigo-500 h-2 rounded-full",style:{width:`${f}%`}})})]}),je=d=>{switch(String(d||"").toLowerCase()){case"aktif":return"bg-green-100 text-green-700";case"draft":return"bg-orange-100 text-orange-700";case"published":return"bg-blue-100 text-blue-700";case"selesai":return"bg-purple-100 text-purple-700";case"tidak aktif":default:return"bg-gray-100 text-gray-600"}};function $e(){const{props:d}=xe(),{user:f}=d,j=d.total_users??0,M=d.total_events??0,K=d.total_eskul??0,S=d.attendance_percentage??{school:"0%"},y=d.users??[],p=d.events??[],$=d.eskuls??[];d.statistik;const[i,h]=s.useState(d.rekap??[]),[m,x]=s.useState("bulan"),[v,Z]=s.useState(n().month()+1),[D,ve]=s.useState(n().year()),[z,ye]=s.useState(1),[P,te]=s.useState(""),[Ne,Q]=s.useState(!1),[N,T]=s.useState("weekly"),[A,ae]=s.useState({sekolah:0,eskul:0,event:0});s.useEffect(()=>{G.get(`/api/admin/dashboard/statistik?range=${N}`).then(t=>ae(t.data)).catch(t=>console.error("Gagal ambil statistik:",t))},[N]);const se=async()=>{Q(!0);try{const t={filter:m,bulan:v,tahun:D,semester:z,type:"sekolah"},a=await G.get("/api/admin/rekap-kehadiran",{params:t}),o=(a.data?.data??a.data??[]).map(c=>{const q=d.rekap?.find(me=>me.id===c.murid_id);return{...c,avatar:c.avatar||q?.avatar||"/default-avatar.png"}});h(Array.isArray(o)?o:[])}catch(t){console.error("Gagal ambil rekap:",t),h([])}finally{Q(!1)}};s.useEffect(()=>{se()},[m,v,D,z]);const V=s.useMemo(()=>{const t=P.trim().toLowerCase();return t?i.filter(a=>{const r=(a.nama||a.name||"").toString().toLowerCase(),o=(a.kelas||a.kelas_nama||"").toString().toLowerCase();return r.includes(t)||o.includes(t)}):i},[i,P]),re=V.slice(0,3),[l,H]=s.useState("bulanan"),[R,ne]=s.useState([]),[Y,de]=s.useState(""),[g,C]=s.useState(n().isoWeekday(1).startOf("day")),[k,_]=s.useState(n().isoWeekday(5).endOf("day"));s.useEffect(()=>{let t,a;if(l==="mingguan")t=n().isoWeekday(1).startOf("day"),a=n().isoWeekday(5).endOf("day");else if(l==="bulanan")t=n().startOf("month"),a=n().endOf("month");else{const r=n().month()+1,o=r>=1&&r<=6?1:2,c=n().year();o===1?(t=n(`${c}-01-01`),a=n(`${c}-06-30`)):(t=n(`${c}-07-01`),a=n(`${c}-12-31`))}C(t),_(a)},[l]);const w=s.useMemo(()=>{const t=Y.trim().toLowerCase();return t?R.filter(a=>(a.nama||a.name||"").toString().toLowerCase().includes(t)):R},[R,Y]);console.log("Rekap dari backend:",d.rekap);const[b,ke]=s.useState(n()),[we]=s.useState(""),[I,ie]=s.useState(""),[U,le]=s.useState(""),oe=s.useMemo(()=>{if(l==="mingguan")return g.month()===k.month()?`${g.format("DD")}–${k.format("DD MMMM YYYY")}`:`${g.format("DD MMM")}–${k.format("DD MMM YYYY")}`;if(l==="bulanan")return g.format("MMMM YYYY");const t=g.month()+1;return`Semester ${t>=1&&t<=6?1:2} — ${g.year()}`},[l,g,k]),ce=()=>{let t,a;if(l==="mingguan")t=b.isoWeekday(1),a=b.isoWeekday(5),t.month()===a.month()?`${t.format("DD")}${a.format("DD MMMM YYYY")}`:`${t.format("DD MMM")}${a.format("DD MMM YYYY")}`;else if(l==="bulanan")t=b.startOf("month"),a=b.endOf("month"),b.format("MMMM YYYY");else{const r=b.month()+1,o=r>=1&&r<=6?1:2,c=b.year();o===1?(t=n(`${c}-01-01`),a=n(`${c}-06-30`)):(t=n(`${c}-07-01`),a=n(`${c}-12-31`))}ie(t.format("YYYY-MM-DD")),le(a.format("YYYY-MM-DD"))};s.useEffect(()=>{ce()},[l,b]);const X=t=>{const a=t==="prev"?-1:1;l==="mingguan"?(C(r=>r.add(a,"week").isoWeekday(1)),_(r=>r.add(a,"week").isoWeekday(5))):l==="bulanan"?(C(r=>r.add(a,"month").startOf("month")),_(r=>r.add(a,"month").endOf("month"))):(C(r=>{const o=r.add(a*6,"month");return(o.month()+1<=6?n(`${o.year()}-01-01`):n(`${o.year()}-07-01`)).startOf("day")}),_(r=>{const o=r.add(a*6,"month");return(o.month()+1<=6?n(`${o.year()}-06-30`):n(`${o.year()}-12-31`)).endOf("day")})),W(1)};s.useEffect(()=>{!I||!U||G.get("/api/admin/dashboard/report",{params:{range:l,start_date:I,end_date:U}}).then(t=>ne(t.data.data??[])).catch(t=>console.error("Gagal ambil report:",t))},[I,U]);const[u,W]=s.useState(1),E=5;s.useEffect(()=>{W(1)},[l,g,k,Y,R]);const F=w.length,O=Math.max(1,Math.ceil(F/E));return s.useMemo(()=>{const t=(u-1)*E;return w.slice(t,t+E)},[w,u]),e.jsxs("div",{className:"min-h-screen bg-gray-100 text-gray-800 flex flex-col",children:[e.jsx(ue,{title:"Dashboard"}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("aside",{className:"hidden md:block md:w-60 bg-white p-4 shadow-lg min-h-screen",children:e.jsxs("nav",{className:"space-y-2 text-sm",children:[e.jsx("div",{onClick:()=>window.location.href="/Admin/Dashboard",className:"p-2 rounded bg-[#E86D1F] font-medium cursor-pointer text-white",children:"🏠 Dashboard"}),e.jsx("div",{onClick:()=>window.location.href="/Admin/UserManagement",className:"p-2 rounded hover:bg-gray-200 cursor-pointer",children:"👥 User Manajemen"}),e.jsx("div",{onClick:()=>window.location.href="/admin/events",className:"p-2 rounded hover:bg-gray-200 cursor-pointer",children:"📅 Event Manajemen"}),e.jsx("div",{onClick:()=>window.location.href="/admin/eskul",className:"p-2 rounded hover:bg-gray-200 cursor-pointer",children:"⚽ Ekstrakurikuler"}),e.jsx("div",{onClick:()=>window.location.href="/admin/riwayat-kehadiran",className:"p-2 rounded hover:bg-gray-200 cursor-pointer",children:"📈 Riwayat Kehadiran"}),e.jsx("div",{onClick:()=>window.location.href="/admin/statistik-kehadiran",className:"p-2 rounded hover:bg-gray-200 cursor-pointer",children:"📈 Statistik Kehadiran"}),e.jsx("div",{onClick:()=>window.location.href="/admin/laporan-kehadiran",className:"p-2 rounded hover:bg-gray-200 cursor-pointer",children:"📄 Laporan"})]})}),e.jsxs("main",{className:"flex-1 overflow-x-auto p-4",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-6 gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"p-2 rounded border bg-white",children:"⚙️"}),e.jsx("button",{className:"p-2 rounded border bg-white",children:"🔓"}),e.jsxs("div",{className:"flex items-center gap-2 bg-white p-2 rounded-xl shadow",children:[e.jsx("img",{src:d.auth?.user?.avatar??"/images/avatar-placeholder.png",alt:"avatar",className:"w-8 h-8 rounded-full object-cover"}),e.jsx("div",{className:"text-sm",children:d.auth?.user?.name??"Admin"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(L,{title:"Total Siswa",value:j}),e.jsx(L,{title:"Event Aktif",value:M}),e.jsx(L,{title:"Ekstrakulikuler",value:K}),e.jsx(L,{title:"Rata-rata Kehadiran",value:S.school??"0%"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-[#6200EE]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{className:"font-semibold",children:"User"}),e.jsx("button",{className:"text-sm bg-[#6200EE] text-white px-3 py-1 rounded",children:"tambah"})]}),e.jsxs("div",{className:"space-y-3 max-h-90 overflow-y-auto pr-2",children:[y.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"Tidak ada data user"}),y.map(t=>e.jsxs("div",{className:"flex items-center justify-between border rounded-lg p-2 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.avatar?.startsWith("data:image")?t.avatar:t.avatar_path?`/storage/${t.avatar_path.replace(/^public\//,"")}`:"/default-avatar.png",alt:t.name,className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.role??"Siswa"})]})]}),e.jsx("div",{className:"text-gray-400",children:"..."})]},t.id))]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-[#6200EE]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{className:"font-semibold",children:"Event"}),e.jsx("button",{className:"text-sm bg-[#6200EE] text-white px-3 py-1 rounded",children:"tambah"})]}),e.jsxs("div",{className:"space-y-3 max-h-90 overflow-y-auto pr-2",children:[p.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"Tidak ada event"}),p.map(t=>e.jsxs("div",{className:"flex items-center justify-between border rounded-lg p-2 w-full",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.title||t.nama||"Event"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.start_date?new Date(t.start_date).toLocaleDateString():""," - ",t.end_date?new Date(t.end_date).toLocaleDateString():""]})]}),e.jsx("div",{className:`text-xs font-semibold px-3 py-1 rounded-full ${je(t.status_event)}`,children:t.status_event??"Tidak Aktif"})]},t.id))]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-[#6200EE]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{className:"font-semibold",children:"Ekstrakulikuler"}),e.jsx("button",{className:"text-sm bg-[#6200EE] text-white px-3 py-1 rounded",children:"tambah"})]}),e.jsxs("div",{className:"space-y-3 max-h-80 overflow-y-auto pr-2",children:[$.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"Tidak ada eskul"}),$.map(t=>e.jsxs("div",{className:"flex items-center justify-between border rounded-lg p-3 w-full",children:[e.jsx("div",{className:"font-medium",children:t.nama}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-xs text-white border rounded-lg bg-orange-600 p-1",children:[t.anggota_count??t.anggota??0," Anggota"]}),e.jsx("div",{children:"..."})]})]},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-[#6200EE] h-91",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold",children:"Statistik Kehadiran"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>T("weekly"),className:`px-3 py-1 rounded ${N==="weekly"?"bg-[#6200EE] text-white":"bg-gray-100"}`,children:"Mingguan"}),e.jsx("button",{onClick:()=>T("monthly"),className:`px-3 py-1 rounded ${N==="monthly"?"bg-[#6200EE] text-white":"bg-gray-100"}`,children:"Bulanan"}),e.jsx("button",{onClick:()=>T("semester"),className:`px-3 py-1 rounded ${N==="semester"?"bg-[#6200EE] text-white":"bg-gray-100"}`,children:"Semester"})]})]}),e.jsxs("div",{children:[e.jsx(J,{label:"Kehadiran sekolah",percent:Number(A.sekolah)}),e.jsx(J,{label:"Kehadiran Ekstrakulikuler",percent:Number(A.eskul)}),e.jsx(J,{label:"Kehadiran Event",percent:Number(A.event)})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow border border-[#6200EE] p-5",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-[30px] font-semibold mb-3",children:"Rekap Kehadiran Siswa"})}),e.jsx("div",{className:"flex flex-wrap justify-end items-center mb-4 gap-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"flex items-center gap-1 bg-[#7B4EFF] text-white px-3 py-1.5 rounded-lg text-[15px]",children:"⚙️ Filter"}),e.jsx("button",{onClick:()=>x("bulan"),className:`px-3 py-1.5 rounded-lg text-sm ${m==="bulan"?"bg-[#7B4EFF] text-white":"border border-[#7B4EFF] text-[#7B4EFF]"}`,children:"Bulanan"}),e.jsx("button",{onClick:()=>x("semester"),className:`px-3 py-1.5 rounded-lg text-sm ${m==="semester"?"bg-[#7B4EFF] text-white":"border border-[#7B4EFF] text-[#7B4EFF]"}`,children:"Semester"}),e.jsx("input",{type:"text",placeholder:"Cari",className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm",value:P,onChange:t=>te(t.target.value)})]})}),e.jsxs("div",{className:"space-y-2",children:[V.length===0&&e.jsx("div",{className:"text-sm text-gray-500 text-center",children:"Tidak ada data"}),re.map((t,a)=>(console.log("Rekap avatar URL:",t.avatar),e.jsxs("div",{className:"flex items-center justify-between border rounded-xl p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.avatar||"/default-avatar.png",alt:t.nama,onError:r=>r.currentTarget.src="/default-avatar.png",className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.nama}),e.jsx("div",{className:"text-xs text-gray-500",children:t.kelas})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 text-right",children:t.total??"-"}),e.jsx("div",{className:"font-semibold text-[#7B4EFF]",children:t.persentase??0})]})]},a)))]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-[#6200EE]",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-3 gap-3",children:[e.jsx("div",{className:"font-semibold text-lg",children:"Report Kehadiran"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>X("prev"),className:"px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200",children:"◀"}),e.jsx("div",{className:"text-sm font-medium text-gray-700 min-w-[150px] text-center",children:oe}),e.jsx("button",{onClick:()=>X("next"),className:"px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200",children:"▶"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsx("button",{onClick:()=>H("mingguan"),className:`px-3 py-1 rounded ${l==="mingguan"?"bg-[#6200EE] text-white":"bg-gray-100"}`,children:"Mingguan"}),e.jsx("button",{onClick:()=>H("bulanan"),className:`px-3 py-1 rounded ${l==="bulanan"?"bg-[#6200EE] text-white":"bg-gray-100"}`,children:"Bulanan"}),e.jsx("button",{onClick:()=>H("semester"),className:`px-3 py-1 rounded ${l==="semester"?"bg-[#6200EE] text-white":"bg-gray-100"}`,children:"Semester"}),e.jsx("input",{value:Y,onChange:t=>de(t.target.value),placeholder:"cari",className:"border rounded px-3 py-2 text-sm"}),e.jsx("button",{className:"px-3 py-2 bg-green-500 text-white rounded",children:"Download Report"})]})]}),e.jsxs("div",{className:"overflow-auto",children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"No"}),e.jsx("th",{className:"py-2 pr-4",children:"Nama"}),e.jsx("th",{className:"py-2 pr-4",children:"Kelas"}),e.jsx("th",{className:"py-2 pr-4",children:"Kejuruan"}),e.jsx("th",{className:"py-2 pr-4",children:"Jumlah Hadir Sekolah"}),e.jsx("th",{className:"py-2 pr-4",children:"Jumlah Hadir Ekstrakulikuler"}),e.jsx("th",{className:"py-2 pr-4",children:"Jumlah Hadir Event"}),e.jsx("th",{className:"py-2 pr-4",children:"Total Kehadiran"}),e.jsx("th",{className:"py-2 pr-4",children:"Keterangan"})]})}),e.jsxs("tbody",{children:[w.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"py-6 text-center text-gray-500",children:"Tidak ada data report"})}),w.map((t,a)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 pr-4",children:t.no??a+1}),e.jsx("td",{className:"py-3 pr-4",children:t.nama??t.name}),e.jsx("td",{className:"py-3 pr-4",children:t.kelas}),e.jsx("td",{className:"py-3 pr-4",children:t.kejuruan}),e.jsx("td",{className:"py-3 pr-4",children:t.hadir_sekolah??t.jumlah_hadir_sekolah??0}),e.jsx("td",{className:"py-3 pr-4",children:t.hadir_ekskul??t.jumlah_hadir_ekskul??0}),e.jsx("td",{className:"py-3 pr-4",children:t.hadir_event??t.jumlah_hadir_event??0}),e.jsx("td",{className:"py-3 pr-4",children:t.total??t.jumlah_total??0}),e.jsx("td",{className:"py-3 pr-4",children:t.keterangan??"Baik"})]},t.no??t.id??a))]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",Math.min((u-1)*E+1,F)," - ",Math.min(u*E,F)," dari ",F]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>W(t=>Math.max(1,t-1)),disabled:u===1,className:`px-2 py-1 rounded border ${u===1?"opacity-50 cursor-not-allowed":""}`,children:"Prev"}),e.jsxs("div",{className:"text-sm",children:[u," / ",O]}),e.jsx("button",{onClick:()=>W(t=>Math.min(O,t+1)),disabled:u===O,className:`px-2 py-1 rounded border ${u===O?"opacity-50 cursor-not-allowed":""}`,children:"Next"})]})]})]})]})]})]})]})}export{$e as default};
