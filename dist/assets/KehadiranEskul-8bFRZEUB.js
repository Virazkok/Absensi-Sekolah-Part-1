import{u as N,r as o,j as e,H,a as g}from"./app-XaT7IJdh.js";import{A as F}from"./AuthenticatedLayout-t6Yl5pHZ.js";import{B as P}from"./BottomNavbar-DqHaFEyb.js";import{C}from"./camera-CrfZnPgd.js";/* empty css            */import"./createLucideIcon-PjBRytQg.js";function E(){const{props:j}=N(),{auth:l,absensi:m,kehadiran:s}=j,[u,x]=o.useState(null),[d,h]=o.useState(null),[c,f]=o.useState(null),[i,p]=o.useState(!1),w=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),k=t=>new Promise((a,r)=>{const n=new FileReader;n.readAsDataURL(t),n.onload=()=>a(n.result),n.onerror=v=>r(v)}),y=async t=>{const a=t.target.files?.[0]||null;if(a){h(a),x(URL.createObjectURL(a));try{const r=await k(a);f(r)}catch(r){console.error("Gagal konversi foto ke base64:",r)}}else h(null),f(null),x(null)},b=async t=>{if(t==="Hadir"&&!d&&!c){alert("Harap ambil foto terlebih dahulu sebelum memilih Hadir!");return}p(!0);try{if(d){const a=new FormData;a.append("status",t),a.append("foto",d),await g.post(`/murid/eskul/kehadiran/${m.id}`,a,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0})}else c&&await g.post(`/murid/eskul/kehadiran/${m.id}`,{status:t,foto:c},{withCredentials:!0});alert("Kehadiran berhasil disimpan!"),window.location.href="/murid/eskul"}catch(a){console.error("Gagal kirim kehadiran:",a),alert("Terjadi kesalahan saat menyimpan kehadiran.")}finally{p(!1)}};return e.jsxs(F,{user:l.user,children:[e.jsx(H,{title:"Kehadiran Eskul"}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-white text-gray-900",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("img",{src:l.user.avatar||"/default-avatar.png",alt:"Profile",className:"w-14 h-14 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:l.user.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:l.user.kelas??"Kelas belum terisi"})]})]}),s?e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[s.status==="Hadir"&&s.foto&&e.jsx("img",{src:`/storage/${s.foto}`,alt:"Foto Kehadiran",className:"w-[90%] max-w-sm aspect-square object-cover rounded-lg mb-4"}),e.jsxs("div",{className:`px-4 py-2 rounded-xl text-center text-white font-semibold ${s.status==="Hadir"?"bg-green-500":"bg-red-500"}`,children:["Status: ",s.status]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center mt-6 border-b border-t pb-4",children:[e.jsxs("label",{className:"relative w-[90%] max-w-sm aspect-square bg-gray-100 rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",children:[u?e.jsx("img",{src:u,alt:"Preview",className:"object-cover w-full h-full"}):e.jsxs("div",{className:"flex flex-col items-center text-gray-500",children:[e.jsx(C,{className:"w-10 h-10 mb-3"}),e.jsx("p",{className:"text-xs bg-gray-200 px-4 py-1 rounded-full shadow",children:"Ambil foto dahulu untuk kehadiran eskul!"})]}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:y,className:"absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer"})]}),!w&&e.jsxs("p",{className:"text-red-500 text-sm mt-3 text-center px-4",children:["⚠️ Fitur kamera hanya tersedia di perangkat mobile. ",e.jsx("br",{}),"Silakan buka halaman ini melalui HP Anda."]})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6 mb-6",children:[e.jsx("button",{onClick:()=>b("Hadir"),disabled:i,className:"bg-green-500 text-white text-sm px-6 py-2 rounded-lg shadow-md w-32 text-center",children:i?"Menyimpan...":"Hadir"}),e.jsx("button",{onClick:()=>b("Tidak Hadir"),disabled:i,className:"bg-red-500 text-white text-sm px-6 py-2 rounded-lg shadow-md w-32 text-center",children:i?"Menyimpan...":"Tidak Hadir"})]})]})]}),e.jsx(P,{})]})}export{E as default};
