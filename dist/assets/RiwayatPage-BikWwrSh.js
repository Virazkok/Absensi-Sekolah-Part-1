import{r as t,a as y,j as e}from"./app-XaT7IJdh.js";import{B as I}from"./BottomNavbar-DqHaFEyb.js";import{S as F}from"./sliders-horizontal-8qvEX_Aq.js";import{F as R,a as A}from"./ChevronRightIcon-B-Y4U1Qp.js";/* empty css            */import"./createLucideIcon-PjBRytQg.js";y.defaults.withCredentials=!0;y.defaults.baseURL="http://127.0.0.1:8000";const b=s=>{if(!s||s==="N/A")return"-";try{const x=new Date(s);return isNaN(x.getTime())?s:x.toLocaleDateString("id-ID",{day:"numeric",month:"long"})}catch{return s}},M=s=>!s||s==="-"?"-":s.includes(":")?s.split(":").slice(0,2).join(":"):s;function G(){const[s,x]=t.useState("sekolah"),[d,u]=t.useState("weekly"),[g,N]=t.useState([]),[m,k]=t.useState({}),[$,v]=t.useState(!1),[i,H]=t.useState(null),[f,w]=t.useState(""),[n,j]=t.useState(0),[l,h]=t.useState(new Date().getMonth()),[o,_]=t.useState(new Date().getFullYear()),K=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];t.useEffect(()=>{const a=JSON.parse(localStorage.getItem("user")||"{}");a&&a.id&&H(a)},[]),t.useEffect(()=>{N([]),k({}),w(""),u(s==="event"?"range":"weekly"),j(0)},[s]),t.useEffect(()=>{L()},[s,d,n,l,o,i]);async function L(){if(i)try{v(!0);let a=`/api/riwayat?type=${s}`;s!=="event"&&(a+=d==="weekly"?`&mode=weekly&week=${n}`:`&mode=monthly&month=${l+1}&year=${o}`);const r=await y.get(a);N(Array.isArray(r.data.data)?r.data.data:[]),k(r.data.summary||{})}catch(a){console.error("Error fetching data:",a)}finally{v(!1)}}const D=a=>{const r=new Date,p=new Date(r);p.setDate(r.getDate()+a*7);const c=new Date(p),E=c.getDay(),z=c.getDate()-E+(E===0?-6:1);c.setDate(z);const T=new Date(c);return T.setDate(c.getDate()+6),{start:c,end:T}},S=a=>a.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"}),C=s==="event"&&f?g.filter(a=>a.event_name?.toLowerCase().includes(f.toLowerCase())):g,O=()=>({sekolah:["Tanggal","Check In","Check Out","Keterangan"],eskul:["Tanggal","Keterangan","Nama Eskul"],event:["Tanggal","Nama Event","Keterangan"]})[s].map((r,p)=>e.jsx("th",{className:"py-2 px-2",children:r},p)),W=a=>s==="sekolah"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-2 px-2",children:b(a.tanggal)}),e.jsx("td",{className:"py-2 px-2",children:M(a.jam_masuk)}),e.jsx("td",{className:"py-2 px-2",children:M(a.jam_keluar)}),e.jsx("td",{className:"py-2 px-2 capitalize",children:a.kehadiran==="hadir"?"Hadir":a.kehadiran==="absen"?"Tidak Hadir":a.kehadiran==="terlambat"?"Terlambat":a.kehadiran})]}):s==="eskul"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-2 px-2",children:b(a.tanggal)}),e.jsx("td",{className:"py-2 px-2 capitalize",children:a.status==="hadir"?"Hadir":a.status==="absen"?"Tidak Hadir":a.status}),e.jsx("td",{className:"py-2 px-2",children:a.eskul_name})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-2 px-2",children:b(a.tanggal)}),e.jsx("td",{className:"py-2 px-2",children:a.event_name}),e.jsx("td",{className:"py-2 px-2 capitalize text-gray-600 font-medium",children:"Mengikuti"})]});return e.jsxs("div",{className:"min-h-screen bg-white p-4 text-gray-900 pb-20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 ",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border-2 border-gray-300 shadow",children:e.jsx("img",{src:i?.avatar||"/default-avatar.png",alt:"Foto Profil",className:"w-full h-full object-cover",onError:a=>{a.target.src="/default-avatar.png"}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:i?.name||"Nama Siswa"}),e.jsx("p",{className:"text-sm text-gray-600",children:i?.kelas?.name||"Kelas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-10 mb-3",children:[e.jsx(F,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm",children:"Filter "})]}),e.jsx("div",{className:"flex overflow-x-auto gap-2 mb-4 pb-2 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ",children:["sekolah","eskul","event"].map(a=>e.jsxs("button",{onClick:()=>x(a),className:` px-4 py-2 rounded-xl text-sm shadow-[7px_7px_10px_-2px_rgba(0,_0,_0,_0.25)] w-28.25 text-[12px] ${s===a?"bg-orange-500 text-white":"border border-orange-500"}`,children:["Riwayat ",a.charAt(0).toUpperCase()+a.slice(1)]},a))}),(s==="sekolah"||s==="eskul")&&e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("div",{className:"flex-1 bg-purple-300 rounded-xl shadow text-center py-3 shadow-[7px_7px_10px_-2px_rgba(0,_0,_0,_0.25)] ",children:[e.jsx("p",{className:"font-semibold",children:m.hadir??0}),e.jsx("p",{className:"text-sm ",children:"Hadir"})]}),e.jsxs("div",{className:"flex-1 bg-purple-300 rounded-xl shadow text-center py-3 shadow-[7px_7px_10px_-2px_rgba(0,_0,_0,_0.25)]",children:[e.jsx("p",{className:"font-semibold",children:m.absen??0}),e.jsx("p",{className:"text-sm",children:"Absen"})]}),e.jsxs("div",{className:"flex-1 bg-purple-300 rounded-xl shadow text-center py-3 shadow-[7px_7px_10px_-2px_rgba(0,_0,_0,_0.25)]",children:[e.jsx("p",{className:"font-semibold",children:s==="sekolah"?m.terlambat??0:m.total??0}),e.jsx("p",{className:"text-sm",children:s==="sekolah"?"Terlambat":"Total"})]})]}),s==="event"&&e.jsxs("div",{className:"bg-purple-300 rounded-xl shadow text-center py-3 mb-4 shadow-[7px_7px_10px_-2px_rgba(0,_0,_0,_0.25)]",children:[e.jsx("p",{className:"text-sm",children:"Keikutsertaan Event"}),e.jsxs("p",{className:"font-semibold",children:[g.length," Event"]})]}),e.jsx("div",{className:"flex justify-between items-center mt-15 mb-2",children:e.jsx("h2",{className:"text-lg font-semibold text-[28px]",children:s==="sekolah"?"Rekap Kehadiran Siswa":s==="eskul"?"Rekap Ekstrakurikuler":"Rekap Event"})}),e.jsxs("div",{className:"flex items-center justify-between mb-3 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm",children:s==="event"?"Cari Event":"Filter"})]}),e.jsx("div",{className:"flex gap-2",children:s==="event"?e.jsx("input",{type:"text",placeholder:"Cari Event...",className:"flex  px-3 py-1 border border-orange-500 rounded-full text-sm mb-10",value:f,onChange:a=>w(a.target.value)}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u("weekly"),className:`px-3 py-1 rounded-full text-sm ${d==="weekly"?"bg-orange-500 text-white":"border border-orange-500"}`,children:"Mingguan"}),e.jsx("button",{onClick:()=>u("monthly"),className:`px-3 py-1 rounded-full text-sm ${d==="monthly"?"bg-orange-500 text-white":"border border-orange-500"}`,children:"Bulanan"})]})})]}),s!=="event"&&e.jsx("div",{className:"mb-3",children:d==="weekly"?e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("button",{onClick:()=>j(n-1),className:"p-1 rounded-full bg-gray-100",children:e.jsx(R,{className:"w-4 h-4 text-gray-600"})}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-sm",children:[S(D(n).start)," - ",S(D(n).end)]})}),e.jsx("button",{onClick:()=>j(n+1),className:"p-1 rounded-full bg-gray-100",children:e.jsx(A,{className:"w-4 h-4 text-gray-600"})})]}):e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("button",{onClick:()=>{l===0?(h(11),_(o-1)):h(l-1)},className:"p-1 rounded-full bg-gray-100",children:e.jsx(R,{className:"w-4 h-4 text-gray-600"})}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-sm font-medium",children:[K[l]," ",o]})}),e.jsx("button",{onClick:()=>{l===11?(h(0),_(o+1)):h(l+1)},className:"p-1 rounded-full bg-gray-100",children:e.jsx(A,{className:"w-4 h-4 text-gray-600"})})]})}),$?e.jsx("p",{className:"text-center text-gray-500",children:"Sedang memuat..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-[12px]",children:[e.jsx("thead",{className:"text-left bg-gray-50",children:e.jsx("tr",{children:O()})}),e.jsx("tbody",{children:C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s==="sekolah"?4:3,className:"text-center py-4 text-gray-500",children:"Tidak ada data"})}):C.map(a=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:W(a)},a.id))})]})}),e.jsx(I,{})]})}export{G as default};
